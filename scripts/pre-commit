#!/bin/sh
# pre-commit hook: フォーマットチェック
# ステージされた Rust ファイルがある場合のみ cargo fmt --check を実行

# ステージされた .rs ファイルがあるか確認（リネームも含む）
STAGED_RS_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep '\.rs$')
if [ -n "$STAGED_RS_FILES" ]; then
    # ステージされたファイルのみをチェック（プロジェクト全体ではなく）
    FMT_OUTPUT=$(echo "$STAGED_RS_FILES" | xargs rustfmt --edition 2024 --check 2>&1)
    FMT_EXIT=$?
    if [ $FMT_EXIT -ne 0 ]; then
        echo ""
        echo "[pre-commit] Format check failed for staged files:"
        echo "$FMT_OUTPUT"
        echo ""
        echo "[pre-commit] Run 'cargo fmt' to fix."
        exit 1
    fi
fi
